---
title: GitHub Pages with jekyll 搭建静态博客
author: hukeyi
date: 2022-11-19 17:06:00 +0800
categories: [Blogging]
tags: []
math: true
mermaid: true
---

## blog 创建流程

如果还未在 github 建立 `xyz.github.io` 仓库，则先看 [官方文档](https://docs.github.com/cn/pages/setting-up-a-github-pages-site-with-jekyll/creating-a-github-pages-site-with-jekyll)，把 “Creating a repository for your site” 按步骤执行。

仓库建好后，执行下面：

### 1. 下载 Jekyll on Mac

我的环境：MacOS, zsh, homebrew

#### 1.1 检查环境

https://jekyllrb.com/docs/installation/

#### 1.2 下载 Ruby

https://jekyllrb.com/docs/installation/macos/

- 【bug】下载 ruby 解决 homebrew 权限问题

报错信息：

```zsh
(base) ➜  ~ ruby-install ruby
>>> Installing ruby 3.1.2 into /Users/uei/.rubies/ruby-3.1.2 ...
>>> Installing dependencies for ruby 3.1.2 ...
Error: Running Homebrew as root is extremely dangerous and no longer supported.
As Homebrew does not drop privileges on installation you would be giving all
build scripts full access to your system.
```

解决方法：

[stackoverflow](https://stackoverflow.com/questions/66544894/cannot-install-homebrew-packages-because-permission-is-denied)

` cd /usr/local && sudo chown -R $(whoami) bin etc include lib sbin share var Frameworks`

- 【bug】No such file or directory @ rb_sysopen all.bottle.tar.gz

依然是执行 `ruby-install ruby` 时报错。

报错信息：

```zsh
==> Installing dependencies for openssl@1.1: ca-certificates
==> Installing openssl@1.1 dependency: ca-certificates
==> Pouring ca-certificates-2022-03-18.all.bottle.tar.gz
Error: No such file or directory @ rb_sysopen - /Users/uei/Library/Caches/Homebrew/downloads/e0b1b67cb3c1993f57c7b16dca8801a867bf6e9ef38ddb36d1f4dad6e598f843--ca-certificates-2022-03-18.all.bottle.tar.gz
!!! Installing dependencies failed!
```

解决方法：

[镜像网站问题](https://zhuanlan.zhihu.com/p/491515480)

使用国内镜像而该镜像未完全同步问题。临时去除镜像即可：

```zsh
export HOMEBREW_BOTTLE_DOMAIN=''
```

执行上一句后重新执行 `ruby-install ruby`。

成功！

```zsh
>>> Successfully installed ruby 3.1.2 into /Users/uei/.rubies/ruby-3.1.2

(base) ➜  ~ ruby -v
ruby 3.1.2p20 (2022-04-12 revision 4491bb740a) [x86_64-darwin21]
```

#### 1.3 下载 jekyll

- jekyll 成功信息

```zsh
Done installing documentation for webrick, unicode-display_width, terminal-table, safe_yaml, rouge, forwardable-extended, pathutil, mercenary, liquid, kramdown, kramdown-parser-gfm, ffi, rb-inotify, rb-fsevent, listen, jekyll-watch, sassc, jekyll-sass-converter, concurrent-ruby, i18n, http_parser.rb, eventmachine, em-websocket, colorator, public_suffix, addressable, jekyll after 20 seconds
27 gems installed

(base) ➜  ~ jekyll -v
jekyll 4.3.1
```

### 2. 开始搭建网站

https://simondosda.github.io/posts/2021-09-14-blog-github-pages-2-setup.html

以下命令均在本地仓库文件夹 `(base) ➜ xyz.github.io git:(master) ✗ ` 下执行。

#### 2.1 下载 jekyll bundler

```
gem install jekyll bundler
```

#### 2.2 在 github.io 项目文件夹 new jekyll

```zsh
jekyll new .
```

项目文件夹必须清空（什么文件都不要放），否则会报错：

```zsh
Conflict: /Users/.../.../my-blog/xyz.github.io exists and is not empty.
                    Ensure /Users/.../.../my-blog/xyz.github.io is empty or else try again with `--force` to proceed and overwrite any files.
```

报这个错的话把 `xyz.github.io` 文件夹内的所有文件删掉后再执行 `jekyll new .` 就好。

成功信息：

```zsh
New jekyll site installed in /Users/.../.../my-blog/xyz.github.io.
```

安装后，项目文件夹长这样：

<img src="./assets/img/22-11/blog00.png" style="zoom:50%;" />

#### 2.3 修改安装文件 Gemfile

打开 Gemfile，修改：

```text
# This will help ensure the proper Jekyll version is running.
# Happy Jekylling!
gem "jekyll", "~> 4.3.1"
# This is the default theme for new Jekyll sites. You may change this to anything you like.
gem "minima", "~> 2.5"
# If you want to use GitHub Pages, remove the "gem "jekyll"" above and
# uncomment the line below. To upgrade, run `bundle update github-pages`.
# gem "github-pages", group: :jekyll_plugins
```

按照注释修改为，修改完记得保存：

```text
# This will help ensure the proper Jekyll version is running.
# Happy Jekylling!
# 【注释掉此行】gem "jekyll", "~> 4.3.1"
# This is the default theme for new Jekyll sites. You may change this to anything you like.
gem "minima", "~> 2.5"
# If you want to use GitHub Pages, remove the "gem "jekyll"" above and
# uncomment the line below. To upgrade, run `bundle update github-pages`.
【去掉下一行的注释，并且指定版本】
gem "github-pages", "~> 227", group: :jekyll_plugins
```

版本号在[Dependency versions | GitHub pages](https://pages.github.com/versions/) 中，找到 `github-pages` 那行对应的版本号：

<img src="./assets/img/22-11/blog01.png" style="zoom:50%;" />

修改完文件长这样：

<img src="./assets/img/22-11/blog02.png" style="zoom:50%;" />

##### 2.4 更新依赖

执行 `bundle update`。

```zsh
bundle update
```

- 【bug】bundler: failed to load command: jekyll (/Users/uei/.gem/ruby/3.1.2/bin/jekyll)
  /Users/uei/.gem/ruby/3.1.2/gems/jekyll-3.9.2/lib/jekyll/commands/serve/servlet.rb:3:in `require': cannot load such file -- webrick (LoadError)

报错信息：

```zsh
(base) ➜  xyz.github.io git:(master) ✗ bundle exec jekyll serve --livereload
Configuration file: /Users/uei/hky/code/my-blog/hukeyi.github.io/_config.yml
To use retry middleware with Faraday v2.0+, install `faraday-retry` gem
            Source: /Users/uei/hky/code/my-blog/hukeyi.github.io
       Destination: /Users/uei/hky/code/my-blog/hukeyi.github.io/_site
 Incremental build: disabled. Enable with --incremental
      Generating...
       Jekyll Feed: Generating feed for posts
                    done in 0.549 seconds.
 Auto-regeneration: enabled for '/Users/uei/hky/code/my-blog/hukeyi.github.io'
bundler: failed to load command: jekyll (/Users/uei/.gem/ruby/3.1.2/bin/jekyll)
/Users/uei/.gem/ruby/3.1.2/gems/jekyll-3.9.2/lib/jekyll/commands/serve/servlet.rb:3:in `require': cannot load such file -- webrick (LoadError)
```

解决方法：[参考](https://talk.jekyllrb.com/t/load-error-cannot-load-such-file-webrick/5417/6)

```zsh
bundle add webrick
```

#### 2.5 本地运行测试

```zsh
(base) ➜  hukeyi.github.io git:(master) ✗ bundle exec jekyll serve --livereload
Configuration file: /Users/uei/hky/code/my-blog/hukeyi.github.io/_config.yml
To use retry middleware with Faraday v2.0+, install `faraday-retry` gem
            Source: /Users/uei/hky/code/my-blog/hukeyi.github.io
       Destination: /Users/uei/hky/code/my-blog/hukeyi.github.io/_site
 Incremental build: disabled. Enable with --incremental
      Generating...
       Jekyll Feed: Generating feed for posts
                    done in 0.217 seconds.
 Auto-regeneration: enabled for '/Users/uei/hky/code/my-blog/hukeyi.github.io'
LiveReload address: http://127.0.0.1:35729
    Server address: http://127.0.0.1:4000/
  Server running... press ctrl-c to stop.

```

打开浏览器，输入 `localhost:4000` 后页面：

<img src="./assets/img/22-11/blog03.png" style="zoom:50%;" />

##### 2.6 把更改全部 push 到 github 上后

浏览器输入 `xyz.github.io`：

<img src="./assets/img/22-11/blog04.png" style="zoom:40%;" />

成功！

## 修改 blog 主题

选择了一个最近仍在更新维护的主题，国人开发。

官方的指南：https://chirpy.cotes.page/posts/getting-started/#option-1-using-the-chirpy-starter

### 1. 下载目标文件

https://github.com/cotes2020/jekyll-theme-chirpy

### 2. 覆盖原本的项目文件夹

用 zip 下载，覆盖整体。

### 3. 写新 post

https://chirpy.cotes.page/posts/write-a-new-post/

把 md 文件放到 `_post/` 文件夹下就好了，注意命名规范 。

### 4. 发布到 Github Actions
